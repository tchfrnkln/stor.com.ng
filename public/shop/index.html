<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tw-elements/dist/css/index.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./tailwind.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('content', () => ({
            togSearch:true,
            togType:false,
            searchFor:"",
            Itemsfrom:"",
            togSearchFunx(){
                this.togSearch = !this.togSearch
                this.togType = true
            },
            togTypeFunx(){
                this.togSearch = true
                this.togType = !this.togType
            },
            stateTyp:"",
            typeSubmit(){
                var typ = document.querySelector('#typeForm');
                typ.addEventListener("submit",(e)=>{
                    e.preventDefault()
                    this.stateTyp = typ.querySelector('select').value
                    this.Itemsfrom = "Nigeria, " + this.stateTyp            
                    this.sortType(this.stateTyp)    
                })
            },
            sortType(x){
                console.log("sortType", x)
                this.product = []
                allToday.forEach(i => {
                    
                    loc = i.store_location
                    
                    if(loc){
                        loc = loc.toLowerCase()
                        str = i.itm_name.toLowerCase()
                        x = x.toLowerCase()
                            
                        if(loc.includes(x) && str.includes(this.searchFor)) {
                            this.product.push(i)
                        }
                    }
                })
            },
            searchSubmit(){
                var srch = document.querySelector('#searchForm')
                srch.addEventListener("submit",(e)=>{
                    e.preventDefault()
                    this.searchFor = srch.querySelector('input').value
                    this.sortAllToday(this.searchFor)
                })
                srch.querySelector('input').addEventListener('input',()=>{
                    this.searchFor = srch.querySelector('input').value
                    this.sortAllToday(this.searchFor)
                    
                    if(this.searchFor == ""){
                        this.showAll()   
                    }
                })
            },
            showAll(){
                this.product = []
                allToday.forEach(i =>{
                    this.product.push(i)
                })  
            },
            sortAllToday(x){
                this.product = []
                allToday.forEach(i => {
                    // loc = i.store_location
                    str = i.itm_name.toLowerCase()
                    x = x.toLowerCase()
                    
                    console.log("this.stateTyp", this.stateTyp);
                    
                    // if(loc){   
                    //     loc = loc.toLowerCase()
                        
                        if(str.includes(x)) {
                            this.product.push(i)
                        }
                    // }
                })
            },
            product:[],
            byPriceCh:false,
            sortByPrice(){
                this.product.sort((a, b) => {
                    if(this.byPriceCh == false) return a.itm_price - b.itm_price;
                    
                    if(this.byPriceCh == true) return b.itm_price - a.itm_price;
                });
                this.byPriceCh = !this.byPriceCh
            },
            localeStr(x){
                return "N "+parseInt(x).toLocaleString()
            },
            prdClicked(x, y){
                // return console.log(x);
                location.assign(`../profile/product/?${x},${y}`)
            }
        }))
    })
    </script>
</head>
<body x-data="content" class="p-6">
    
    <!-- top level -->
    <div class="relative flex justify-between mb-10 align-middle">
        <!-- <p x-show="togType" class="w-5 h-5 rounded-full bg-gray-500 cursor-pointer" @click="togTypeFunx()"></p> -->
        
        <i class="fa-solid fa-location-dot p-3 rounded-full bg-gray-200 cursor-pointer" @click="togTypeFunx()"></i>
        
        <i class="fa-solid fa-magnifying-glass p-3 rounded-full bg-blue-100 cursor-pointer" @click="togSearchFunx()"></i>
        
        <!-- <p x-show="togSearch" @click="togSearchFunx()" class="w-5 h-5 rounded-full bg-blue-500 cursor-pointer"></p> -->
        
    </div>
    
    <!-- mid search and location -->
    <div class="my-10 transition flex justify-center align-middle">
        <div class="w-max relative" x-show="!togType">
            
            <form x-init="typeSubmit()" id="typeForm" class="w-100 md:w-max">
                <div class="flex justify-center">
                    <input class="w-full border p-4 rounded mb-4" type="text" placeholder="Nigeria" readonly>
                    
                    <select id="states" class="w-full p-4 border rounded mb-4" required></select>
                </div>
                
                <input type="submit" class="w-full bg-blue-600 p-4 rounded text-white font-bold cursor-pointer active:bg-blue-500" value="See Offers">
            </form>
            
            <i class="absolute right-0 -top-8 bg-red-200 px-2 p-1 rounded-full fa-solid fa-xmark cursor-pointer" @click="togTypeFunx()"></i>
        </div>
        
        <form x-init="searchSubmit()" id="searchForm" x-show="!togSearch" class="w-full relative  transition flex justify-center">
            <input class="md:w-3/5 w-full p-3 border rounded pr-6" placeholder="Search for an Item">
                <i class="absolute -right-2 -top-8 bg-red-200 px-2 p-1 rounded-full cursor-pointer fa-solid fa-xmark" @click="togSearchFunx()"></i>
            </input>
        </form>
    </div>
    
    <!-- Head -->
    <div class="flex justify-between">
        <h1 x-show="!searchFor && !Itemsfrom" class="text-xl font-medium flex justify-between">
            <p>Trending today
                <!-- <i class="text-green-600 fa-solid fa-fire"></i> -->
            </p>
        </h1>
        <div>
            <h1 x-text="searchFor" class="capitalize text-xl font-medium"></h1>
            <h1 x-text="Itemsfrom" class="text-sm"></h1>
        </div>
        <div class="h-max">
            <i class="fa-solid fa-sort p-2 px-3 bg-blue-300 rounded-full cursor-pointer" @click="sortByPrice()"></i>
        </div>
    </div>
    
    <!-- Resulting products -->
    <div class="grid grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-3 my-12">
        <template x-for="p in product">
                <div class="w-full h-52 bg-gray-100 rounded overflow-hidden cursor-pointer" @click="prdClicked(p.id, p.store_uid)">
                    <div class="h-28 bg-blue-100"  :src="p.img"></div>
                    <div class="p-4">
                        <h1 class="text-sm" x-text="p.itm_name"></h1>
                        <p class="text-xs" x-text="localeStr(p.itm_price)"></p>
                        <p class="text-xs" x-text="p.store_location"></p>
                    </div>
                </div>
        </template>
    </div>

    
    
    <!-- trigger -->
    <p @click="showAll()" id="showAll" class="hidden"></p>
    
    <!-- states Selects -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function(){
      var states = ["Abia","Adamawa","Akwa Ibom","Anambra","Bauchi","Bayelsa","Benue","Borno","Cross River","Delta","Ebonyi","Edo","Ekiti","Enugu","Gombe","Imo","Jigawa","Kaduna","Kano","Katsina","Kebbi","Kogi","Kwara","Lagos","Nasarawa","Niger","Ogun","Ondo","Osun","Oyo","Plateau","Rivers","Sokoto","Taraba","Yobe","Zamfara", "FCT"];
      $.each(states, function(i, state){
        $("#states").append("<option value='"+state+"'>"+state+"</option>");
      });
    });
  </script>
    
    
<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>

<script src="../auths.js"></script>
<script src="script.js"></script>

</body>
</html>